//@version=5
indicator("ğŸ“Š trend power + Ichimoku + Volume + VWAP + VWMA (Ø¨Ø§ Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ)", overlay=true)

// ===================================================================
//                            ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
// ===================================================================
length = input.int(14, title="Ø¨Ø§Ø²Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø¯Ø±Øª")
smaLength = input.int(50, title="Ø·ÙˆÙ„ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø±ÙˆÙ†Ø¯")
vwmaLength = input.int(20, title="Ø·ÙˆÙ„ Ù…ÛŒØ§Ù†Ú¯in Ø­Ø¬Ù…ÛŒ (VWMA)") // ÙˆØ±ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ VWMA

// ===================================================================
//                           Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§
// ===================================================================

// Ù‚Ø¯Ø±Øª Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´
bullishCount = 0
bearishCount = 0
for i = 0 to length - 1
    bullishCount += close[i] > open[i] ? 1 : 0
    bearishCount += close[i] < open[i] ? 1 : 0

total = bullishCount + bearishCount
bullPower = total > 0 ? (bullishCount / total) * 100 : 0
bearPower = total > 0 ? (bearishCount / total) * 100 : 0
currPower = bullPower > bearPower ? "Ø®Ø±ÛŒØ¯Ø§Ø±" : bullPower < bearPower ? "ÙØ±ÙˆØ´Ù†Ø¯Ù‡" : "Ø¨Ø±Ø§Ø¨Ø±"

// ØªØ§Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø­Ø¬Ù…
formatVolume(volume) =>
    if volume >= 1e9
        str.tostring(volume / 1e9, "#.##") + "B"
    else if volume >= 1e6
        str.tostring(volume / 1e6, "#.##") + "M"
    else if volume >= 1e3
        str.tostring(volume / 1e3, "#.##") + "K"
    else
        str.tostring(volume, "#.##")

// Ø±ÙˆÙ†Ø¯ Ø¨Ø§ SMA
sma = ta.sma(close, smaLength)
trend = close > sma ? "ØµØ¹ÙˆØ¯ÛŒ" : close < sma ? "Ù†Ø²ÙˆÙ„ÛŒ" : "Ø®Ù†Ø«ÛŒ"
trendColor = trend == "ØµØ¹ÙˆØ¯ÛŒ" ? color.green : trend == "Ù†Ø²ÙˆÙ„ÛŒ" ? color.red : color.gray

// ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ RSI Ùˆ MACD
rsi = ta.rsi(close, 14)
rsiSignal = rsi > 50 ? "âœ… RSI ØµØ¹ÙˆØ¯ÛŒ" : rsi < 50 ? "âŒ RSI Ù†Ø²ÙˆÙ„ÛŒ" : "âš ï¸ RSI Ø®Ù†Ø«ÛŒ"

[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)
macdSignal = macdLine > signalLine ? "âœ… MACD ØµØ¹ÙˆØ¯ÛŒ" : macdLine < signalLine ? "âŒ MACD Ù†Ø²ÙˆÙ„ÛŒ" : "âš ï¸ MACD Ø®Ù†Ø«ÛŒ"

// ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ Volume
vol = volume
volMA = ta.sma(vol, 20)
volumeSignal = vol > volMA ? "ğŸ“ˆ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ (ØªØ§ÛŒÛŒØ¯)" : "ğŸ“‰ Ø­Ø¬Ù… Ù¾Ø§ÛŒÛŒÙ† (Ø¶Ø¹ÛŒÙ)"

// ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ Ichimoku
conversionLine = (ta.highest(high, 9) + ta.lowest(low, 9)) / 2
baseLine = (ta.highest(high, 26) + ta.lowest(low, 26)) / 2
senkouA = (conversionLine + baseLine) / 2
senkouB = (ta.highest(high, 52) + ta.lowest(low, 52)) / 2
ichimokuSignal = close > math.max(senkouA, senkouB) ? "â˜ï¸ Ø¨Ø§Ù„Ø§ÛŒ Ø§Ø¨Ø± (Ù…Ø«Ø¨Øª)" :
                 close < math.min(senkouA, senkouB) ? "ğŸŒ§ï¸ Ø²ÛŒØ± Ø§Ø¨Ø± (Ù…Ù†ÙÛŒ)" :
                 "ğŸŒ«ï¸ Ø¯Ø§Ø®Ù„ Ø§Ø¨Ø± (Ø®Ù†Ø«ÛŒ)"

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ VWAP
vwapValue = ta.vwap(close)
vwapSignal = close > vwapValue ? "âœ… Ø¨Ø§Ù„Ø§ÛŒ VWAP (ØµØ¹ÙˆØ¯ÛŒ)" : close < vwapValue ? "âŒ Ø²ÛŒØ± VWAP (Ù†Ø²ÙˆÙ„ÛŒ)" : " Ø±ÙˆÛŒ VWAP (Ø®Ù†Ø«ÛŒ)"
// vwapColor = close > vwapValue ? color.new(color.aqua, 40) : color.new(color.purple, 40) : color.new(color.gray, 40)
vwapColor = close > vwapValue ? color.new(color.aqua, 40) : close < vwapValue ? color.new(color.purple, 40) : color.new(color.gray, 40)

// â­ï¸ Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø¨Ø§ VWMA
vwmaValue = ta.vwma(close, vwmaLength)
vwmaSignal = close > vwmaValue ? "âœ… Ø¨Ø§Ù„Ø§ÛŒ VWMA (Ù…Ø«Ø¨Øª)" : "âŒ Ø²ÛŒØ± VWMA (Ù…Ù†ÙÛŒ)"
vwmaColor = close > vwmaValue ? color.new(color.teal, 40) : color.new(color.maroon, 40)

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† 10 Ø±ÙˆØ²Ù‡ (Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§ Ø¨Ù‡ Ø¨ÛŒØ±ÙˆÙ† Ø§Ø² if Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯)
avgVol10D = request.security(syminfo.tickerid, "D", ta.sma(volume, 10))

// ===================================================================
//                       Ø³ÛŒØ³ØªÙ… Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
// ===================================================================
bullScore = 0
bearScore = 0

// 1. Ø§Ù…ØªÛŒØ§Ø² Ø±ÙˆÙ†Ø¯ SMA
if trend == "ØµØ¹ÙˆØ¯ÛŒ"
    bullScore += 1
else if trend == "Ù†Ø²ÙˆÙ„ÛŒ"
    bearScore += 1

// 2. Ø§Ù…ØªÛŒØ§Ø² Ù‚Ø¯Ø±Øª Ú©Ù†Ø¯Ù„â€ŒÙ‡Ø§
if bullPower > bearPower
    bullScore += 1
else if bearPower > bullPower
    bearScore += 1

// 3. Ø§Ù…ØªÛŒØ§Ø² RSI (Ø¨Ø§ Ø¢Ø³ØªØ§Ù†Ù‡ Ù‚ÙˆÛŒâ€ŒØªØ±)
if rsi > 55
    bullScore += 1
else if rsi < 45
    bearScore += 1

// 4. Ø§Ù…ØªÛŒØ§Ø² MACD
if macdLine > signalLine
    bullScore += 1
else if macdLine < signalLine
    bearScore += 1

// 5. Ø§Ù…ØªÛŒØ§Ø² Ichimoku
if close > math.max(senkouA, senkouB)
    bullScore += 1
else if close < math.min(senkouA, senkouB)
    bearScore += 1
    
// 6. Ø§Ù…ØªÛŒØ§Ø² VWAP
if close > vwapValue
    bullScore += 1
else if close < vwapValue
    bearScore += 1

// â­ï¸ Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: 7. Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù…ØªÛŒØ§Ø² VWMA Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø§Ù…ØªÛŒØ§Ø²Ø¯Ù‡ÛŒ
if close > vwmaValue
    bullScore += 1
else if close < vwmaValue
    bearScore += 1

// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ
totalScore = bullScore - bearScore
scoreText = "ğŸ”¥ Ø§Ù…ØªÛŒØ§Ø² Ù‚Ø¯Ø±Øª: " + str.tostring(bullScore) + " / " + str.tostring(bearScore)
scoreColor = totalScore > 0 ? color.new(color.green, 25) : totalScore < 0 ? color.new(color.red, 25) : color.new(color.gray, 25)

// ===================================================================
//                            Ø³Ø§Ø®Øª Ùˆ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„
// ===================================================================
// Ø³Ø§Ø®Øª Ø¬Ø¯ÙˆÙ„ (ØªØ¹Ø¯Ø§Ø¯ Ø³Ø·Ø±Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ 12 Ø§ÙØ²Ø§ÛŒØ´ Ø¯Ø§Ø¯ÛŒÙ…)
var table t = table.new(position.top_right, 1, 12, border_width=1)

// Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ø¯ÙˆÙ„ ÙÙ‚Ø· Ø¯Ø± Ø¢Ø®Ø±ÛŒÙ† Ú©Ù†Ø¯Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
if barstate.islast
    table.cell(t, 0, 0, text=scoreText, text_color=color.white, bgcolor=scoreColor)
    table.cell(t, 0, 1, text="ğŸ“Š Ø±ÙˆÙ†Ø¯: " + trend, text_color=color.white, bgcolor=trendColor)
    table.cell(t, 0, 2, text=" Ù‚Ø¯Ø±Øª Ø®Ø±ÛŒØ¯Ø§Ø±: " + str.tostring(bullPower, "#.##") + "%", text_color=color.green)
    table.cell(t, 0, 3, text="â¤ï¸ Ù‚Ø¯Ø±Øª Ø¨Ø§: " + currPower, text_color=color.white, bgcolor=color.gray)
    table.cell(t, 0, 4, text=rsiSignal, text_color=color.blue)
    table.cell(t, 0, 5, text=macdSignal, text_color=color.orange)
    table.cell(t, 0, 6, text=volumeSignal, text_color=color.fuchsia)
    table.cell(t, 0, 7, text=ichimokuSignal, text_color=color.yellow)
    table.cell(t, 0, 8, text=vwapSignal, text_color=color.white, bgcolor=vwapColor)
    
    // â­ï¸ Ø¨Ø®Ø´ Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´ Ø³ÛŒÚ¯Ù†Ø§Ù„ VWMA Ø¯Ø± Ø¬Ø¯ÙˆÙ„
    table.cell(t, 0, 9, text=vwmaSignal, text_color=color.white, bgcolor=vwmaColor)

    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù…
    avgVolText = "Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø­Ø¬Ù… 10 Ø±ÙˆØ²Ù‡ : " + formatVolume(avgVol10D)
    table.cell(t, 0, 10, text=avgVolText, text_color=color.white, bgcolor=color.navy)

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø­Ø¬Ù… Ø§Ù…Ø±ÙˆØ²
    var float today_volume_so_far = 0.0
    isNewDay = ta.change(time("D"))
    if isNewDay
        today_volume_so_far := volume
    else
        today_volume_so_far += volume

    todayTextvolumeFormat = formatVolume(today_volume_so_far)
    table.cell(t, 0, 11, text="Ø­Ø¬Ù… Ø§Ù…Ø±ÙˆØ²: " + todayTextvolumeFormat, text_color=color.white, bgcolor=color.rgb(73, 71, 45))